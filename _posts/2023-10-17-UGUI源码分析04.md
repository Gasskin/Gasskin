---
title: "UGUI源码分析|04 Selectable与Button"
tags: UGUI
---

# Selectable

继承自UIBehaviour，并实现了另外几个接口

```c#
public class Selectable : UIBehaviour,IMoveHandler,IPointerDownHandler, IPointerUpHandler,IPointerEnterHandler, IPointerExitHandler,ISelectHandler, IDeselectHandler
```

有一个静态属性

```c#
protected static Selectable[] s_Selectables = new Selectable[10];
```

这里保存了所有当前场景中能够选中的物体

Selectable自身并没有太多逻辑，主要是进行交互状态的改变，比如按钮点击时的颜色，禁用的颜色，等等

比如说OnPointerEnter

```c#
public virtual void OnPointerEnter(PointerEventData eventData)
{
    isPointerInside = true;
    EvaluateAndTransitionToSelectionState();
}
```

渐变的主要逻辑在这里

```c#
protected virtual void DoStateTransition(SelectionState state, bool instant)
{
    if (!gameObject.activeInHierarchy)
        return;

    Color tintColor;
    Sprite transitionSprite;
    string triggerName;

    ...

    // 根据选择的渐变方式进行渐变过渡
    switch (m_Transition)
    {
        case Transition.ColorTint:
            StartColorTween(tintColor * m_Colors.colorMultiplier, instant);
            break;
        case Transition.SpriteSwap:
            DoSpriteSwap(transitionSprite);
            break;
        case Transition.Animation:
            TriggerAnimation(triggerName);
            break;
    }
}
```

以最常见的颜色过渡来看

```c#
void StartColorTween(Color targetColor, bool instant)
{
    if (m_TargetGraphic == null)
        return;

    m_TargetGraphic.CrossFadeColor(targetColor, instant ? 0f : m_Colors.fadeDuration, true, true);
}
```

最终会调用**Graphic.CrossFadeColor**，所以UGUI竟然自带颜色过渡的方法？

（但是这要求一个Monobehaviour，因为用的是协程）

# Button

```c#
public class Button : Selectable, IPointerClickHandler, ISubmitHandler
```

可以看到Button就是Selectable添加了另外两个接口而已

